# Development

After cloning this repo, install all dependencies and build:

```sh
npm install
npm run build
```

## Repo structure

All MAJC source code is housed under the `packages` directory:

- `./core`
  - Contains all core shared functionality used to build the other framework-specific sub-packages
- `./heyapi`
  - Auto-generated code containing a fetch client and all of the data structures for the MARS APIs defined in `./heyapi/mars.yml`
- `./iife`
  - A lightweight IIFE wrapper around the `core` sub-package exposed as a `renderPlacement` function
- `./react`
  - A React-specific wrapper around the `core` sub-package containing a `MozAdsPlacement` component as well as related hooks
- `./examples`
  - Examples of different kinds of apps using MAJC


## Linting

This repository is linted using `eslint`. To run the linter:

```sh
npm run lint
```

Or, to fix issues that can be automatically resolved:

```sh
npm run lint:fix
```

## Pre-commit hooks

Husky manages all pre-commits via the `.husky/pre-commit` file. Currently, the only pre-commit hook runs `npm run build` and adds any changes in `./dist` to the commit.

### Disabling hooks locally

If you want to disable pre-commit hooks locally for any reason, set the `HUSKY=0` environment variable or preface `git commit`:

```sh
HUSKY=0 git commit -m "Your commit message"
```

## Example apps

- IIFE
  - `npm run example:iife`
- React
  - `npm run example:react`

NOTE: When testing local changes, be sure to re-build via `npm run build` to ensure the example apps are referencing the latest changes.

## Updating MARS API definitions

All of the code in the `packages/heyapi` sub-package is auto-generated by the API definitions in [`openapi.yml`](https://github.com/mozilla-services/mars/blob/main/openapi/openapi.yml) from the [mozilla-services/mars](https://github.com/mozilla-services/mars) repo. To pull in the latest version of the API definitions and re-generate an updated fetch client and data structures:

```sh
npm run update:mars-api
```

Note: This will only be possible for internal Mozillians who have access to the MARS repo.
